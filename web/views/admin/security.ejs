<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë³´ì•ˆ ì„¤ì • ê´€ë¦¬</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/admin.css">
  <style>
    .security-container {
      padding: 20px;
      max-width: 1000px;
      margin: 0 auto;
    }

    .security-section {
      background: var(--search-bg);
      border: 1px solid var(--input-border);
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }

    .security-section h2 {
      margin-top: 0;
      color: var(--text-color);
    }

    .form-group {
      margin: 15px 0;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: var(--text-color);
      font-weight: bold;
    }

    .form-group input[type="text"],
    .form-group input[type="number"],
    .form-group select {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--input-border);
      border-radius: 4px;
      background: var(--bg-color);
      color: var(--text-color);
    }

    .form-group input[type="checkbox"] {
      margin-right: 8px;
    }

    .btn-save {
      background-color: #4caf50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }

    .btn-save:hover {
      background-color: #45a049;
    }

    .security-list {
      list-style: none;
      padding: 0;
    }

    .security-list li {
      padding: 10px;
      border-bottom: 1px solid var(--input-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .btn-revoke {
      background-color: #f44336;
      color: white;
      padding: 5px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <%- include('nav.ejs') %>
  <div class="security-container">
    <h1>ğŸ” ë³´ì•ˆ ì„¤ì • ê´€ë¦¬</h1>
    
    <section>
      <% if (!user) { %>
      <p>Welcome! Please <a href="/login">log in</a>.</p>
      <% } else { %>
      <p>Hello, <%= user.username %>. <a href="/logout">logout</a>. <a href="/profile">profile</a>.</p>
      <% } %>
    </section>

    <div class="security-section">
      <h2>ì„¸ì…˜ ì„¤ì •</h2>
      <div class="form-group">
        <label>
          <input type="checkbox" id="sessionTimeout" checked>
          ìë™ ì„¸ì…˜ ë§Œë£Œ í™œì„±í™”
        </label>
      </div>
      <div class="form-group">
        <label for="sessionDuration">ì„¸ì…˜ ì§€ì† ì‹œê°„ (ë¶„)</label>
        <input type="number" id="sessionDuration" value="30" min="5" max="1440">
      </div>
      <button class="btn-save" onclick="saveSessionSettings()">ì €ì¥</button>
    </div>

    <div class="security-section">
      <h2>IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸</h2>
      <div class="form-group">
        <label for="ipAddress">IP ì£¼ì†Œ ì¶”ê°€</label>
        <input type="text" id="ipAddress" placeholder="ì˜ˆ: 192.168.1.1">
      </div>
      <button class="btn-save" onclick="addIPWhitelist()">ì¶”ê°€</button>
      
      <h3>ë“±ë¡ëœ IP ëª©ë¡</h3>
      <ul class="security-list">
        <% if (whitelistedIPs && whitelistedIPs.length > 0) { 
          whitelistedIPs.forEach(function(ip) { %>
        <li>
          <span><%= ip %></span>
          <button class="btn-revoke" onclick="removeIP('<%= ip %>')">ì œê±°</button>
        </li>
        <% }); } else { %>
        <li>ë“±ë¡ëœ IPê°€ ì—†ìŠµë‹ˆë‹¤.</li>
        <% } %>
      </ul>
    </div>

    <div class="security-section">
      <h2>API í‚¤ ê´€ë¦¬</h2>
      <div class="form-group">
        <label>
          <input type="checkbox" id="apiKeyRequired" checked>
          API í‚¤ ì¸ì¦ í•„ìˆ˜
        </label>
      </div>
      <button class="btn-save" onclick="generateNewAPIKey()">ìƒˆ API í‚¤ ìƒì„±</button>
      
      <h3>í™œì„± API í‚¤</h3>
      <ul class="security-list">
        <% if (apiKeys && apiKeys.length > 0) { 
          apiKeys.forEach(function(key) { %>
        <li>
          <span><%= key.key %> (ìƒì„±ì¼: <%= key.createdAt %>)</span>
          <button class="btn-revoke" onclick="revokeAPIKey('<%= key.id %>')">ë¹„í™œì„±í™”</button>
        </li>
        <% }); } else { %>
        <li>í™œì„±í™”ëœ API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤.</li>
        <% } %>
      </ul>
    </div>

    <div class="security-section">
      <h2>ë³´ì•ˆ ì •ì±…</h2>
      <div class="form-group">
        <label>
          <input type="checkbox" id="enforceHttps" checked>
          HTTPS ê°•ì œ ì‚¬ìš©
        </label>
      </div>
      <div class="form-group">
        <label>
          <input type="checkbox" id="enableCORS">
          CORS í™œì„±í™”
        </label>
      </div>
      <div class="form-group">
        <label>
          <input type="checkbox" id="enableRateLimit" checked>
          ìš”ì²­ ì œí•œ í™œì„±í™”
        </label>
      </div>
      <button class="btn-save" onclick="saveSecurityPolicy()">ì €ì¥</button>
    </div>
  </div>

  <script src="/js/admin.js"></script>
  <script>
    function saveSessionSettings() {
      const timeout = document.getElementById('sessionTimeout').checked;
      const duration = document.getElementById('sessionDuration').value;
      alert(`ì„¸ì…˜ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.\nìë™ ë§Œë£Œ: ${timeout}\nì§€ì† ì‹œê°„: ${duration}ë¶„`);
    }

    function addIPWhitelist() {
      const ip = document.getElementById('ipAddress').value;
      if (ip) {
        alert(`IP ${ip}ê°€ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        location.reload();
      }
    }

    function removeIP(ip) {
      if (confirm(`IP ${ip}ë¥¼ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        alert(`IP ${ip}ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        location.reload();
      }
    }

    function generateNewAPIKey() {
      if (confirm('ìƒˆ API í‚¤ë¥¼ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        alert('ìƒˆ API í‚¤ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
        location.reload();
      }
    }

    function revokeAPIKey(keyId) {
      if (confirm('ì´ API í‚¤ë¥¼ ë¹„í™œì„±í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        alert('API í‚¤ê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
        location.reload();
      }
    }

    function saveSecurityPolicy() {
      const https = document.getElementById('enforceHttps').checked;
      const cors = document.getElementById('enableCORS').checked;
      const rateLimit = document.getElementById('enableRateLimit').checked;
      alert(`ë³´ì•ˆ ì •ì±…ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.\nHTTPS: ${https}\nCORS: ${cors}\nìš”ì²­ ì œí•œ: ${rateLimit}`);
    }
  </script>
</body>

</html>
